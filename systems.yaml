---
  - name : Base config for all linux host
    hosts: all
    become: True
    tasks:
      - name : Create admin user with uid 5001
        user :
          name : admin
          state : present
          uid : 5001
      - name : Remove user dojo
        user:
          name : dojo
          state : absent
      - name : Install Tree
        yum :
          name : tree
          state : present
      - name : Install ntp
        yum :
          name : ntp
          state : present
      - name : start ntp service
        service : name=ntpd state=started enabled=yes 
        






def send_html_email(licenses, subject, recipient_email):
    import smtplib
    from email.mime.multipart import MIMEMultipart
    from email.mime.text import MIMEText

    # Create an HTML table
    html_table = """
    <html>
    <body>
        <h2>Licenses Expiring in the Next 60 Days</h2>
        <table border="1" style="border-collapse: collapse; width: 100%;">
            <tr>
                <th>Provider</th>
                <th>License Name</th>
                <th>State</th>
                <th>Expiration Date</th>
                <th>Port</th>
                <th>Server</th>
            </tr>
    """
    for lic in licenses:
        html_table += f"""
            <tr>
                <td>{lic['provider']}</td>
                <td>{lic['license_name']}</td>
                <td>{lic['state']}</td>
                <td>{lic['expiration_date']}</td>
                <td>{lic['port']}</td>
                <td>{lic['server']}</td>
            </tr>
        """
    html_table += """
        </table>
    </body>
    </html>
    """

    # Create email
    message = MIMEMultipart()
    message['From'] = "noreply@example.com"
    message['To'] = recipient_email
    message['Subject'] = subject

    # Attach the HTML table
    message.attach(MIMEText(html_table, "html"))

    # Send the email
    try:
        with smtplib.SMTP("localhost") as server:
            server.send_message(message)
        print("Email sent successfully.")
    except Exception as e:
        print(f"Failed to send email: {e}")


# Email the report
if expiring_licenses:
    recipient_email = "recipient@example.com"
    subject = "License Expiration Report"
    send_html_email(expiring_licenses, subject, recipient_email)
else:
    print("No licenses expiring in the next 60 days.")
